<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ejercicio 6</title>
</head>

<body>
    <script type="text/javascript">
        let dia = prompt("Introduce el dia");
        let mes = prompt("Introduce el mes");
        let anio = prompt("Introduce el año");

        if (comprobarFecha(dia, mes, anio)) {
            let edad = calcularEdad(dia, mes, anio)
            if (edad == false) {
                alert("No has escrito la fecha correctamente");
            } else {
                document.write("Tienes " + edad + " años");
            }
        }

        /*
        Funcion: Calcular la edad de una persona
        E: Date de tipo string
        S: Entero con la edad o false en caso de que la fecha sea incorrecta o mayor que el dia actual
        */

        function calcularEdad(dia, mes, anio) {

            //Calculamos la fecha de hoy
            let hoy = new Date();
            //alert(hoy)

            //Se calcula la fecha que recibe
            //Antes, comprobamos que la fecha no es mayor a hoy
            let dia_int = parseInt(dia);
            let mes_int = parseInt(mes) - 1;
            let anio_int = parseInt(anio);

            let dia_hoy = hoy.getDate();
            let mes_hoy = hoy.getMonth();
            let anio_hoy = hoy.getFullYear();

            if (anio_int > anio_hoy || mes_int > mes_hoy) {
                return false;
            } else if (anio_int <= anio_hoy && mes_int <= mes_hoy && dia_int <= dia_hoy) {
                
            //Si el año de la fecha que recibe tiene 4 cifras hay que restarle 1900
             if (anio >= 99) {
                 anio -= 1900;
             }

            //Resto los años de las dos fechas
            edad = hoy.getYear() - anio - 1; //-1 porque no se si ha cumplido años ya este año

            //Si resto los meses y me da menor que 0 entonces no ha cumplido años. Si da mayor si ha cumplido
            if (hoy.getMonth() + 1 - mes < 0){ //+ 1 porque los meses empiezan en 0
                return edad;
            }
            if (hoy.getMonth() + 1 - mes > 0) {
                return edad + 1;
            }

            //Entonces es que eran iguales. Miro los dias
            //Si resto los dias y me da menor que 0 entonces no ha cumplido años. Si da mayor o igual si ha cumplido
            if (hoy.getUTCDate() - dia >= 0) {
                return edad + 1;
            }

            return edad;
                
            }
            //dia_int > dia_hoy || mes_int > mes_hoy

        }

        function comprobarFecha(dia, mes, anio) {
            //Parseamos a enteros las variables anteriores
            let diareal = parseInt(dia);
            let mesreal = parseInt(mes);
            let anioreal = parseInt(anio);

            /*
            Ahora hay que comprobar, segun el mes, cuantos dias tiene:
            Si el mes es 1, 3, 5, 7, 8, 10 o 12; el dia maximo es 31
            Si el mes 4, 6, 9, 11; el dia maximo es 30
            Si el mes es 2; hay que además comprobar que el año sea bisiesto; El dia maximo es 28 o 29 si es bisiesto
            */

            switch (mesreal) {
                case 1:
                case 3:
                case 5:
                case 7:
                case 8:
                case 10:
                case 12:
                    if (diareal < 1) { //Si entramos aqui, comprobamos que el dia ni sea menor a 1 o mayor a 31
                        return false;
                        break;
                    } else if (diareal > 31) {
                        return false;
                        break;
                    }
                    //Si ninguna de las condiciones es activada, la fecha es correcta
                    return true;
                    break;
                case 4:
                case 6:
                case 9:
                case 11:
                    if (diareal < 1) { //Si entramos aqui, comprobamos que el dia ni sea menor a 1 o mayor a 30
                        return false;
                        break;
                    } else if (diareal > 30) {
                        return false;
                        break;
                    }
                    //Si ninguna condicion se activa entonces la fecha es correcta
                    return true;
                    break;
                case 2:
                    //Si entramos aqui lo primero que comprobamos es que el año sea bisiesto o no
                    if (esBisiesto(anioreal)) {
                        if (diareal < 1) { //Si es bisiesto comprobamos que dia ni sea menor a 1 o mayor a 29
                            return false;
                            break;
                        } else if (diareal > 29) {
                            return false;
                            break;
                        }
                        //Si es bisiesto y no se activan ninguna de las condiciones, la fecha es correcta
                        return true;
                        break;
                    } else {
                        if (diareal <
                            1) { //Si estamos aqui, el año no es bisiesto, hay que comprobar que ni dia sea menor a 1 o mayor a 28
                            return false;
                            break;
                        } else if (diareal > 28) {
                            return false;
                            break;
                        }
                        //Si ninguna condicion se activa, la fecha es correcta
                        return true;
                    }
                    break;
                default:
                    //Si se ha escrito otro mes que no se corresponda entonces el mes es incorrecto
                    return false;
                    break;
            }

        }

        /*
        E: Anio
        S: Boolean que dice si un año es bisiesto o no
        */
        function esBisiesto(anio) {
            //Un año es bisiesto si se puede dividir por 4 o por 400, pero no por 100
            if (anio % 4 == 0 && !(anio % 100 == 0 && anio % 400 != 0)) {
                return true;
            }
            return false;
        }
    </script>
</body>

</html>