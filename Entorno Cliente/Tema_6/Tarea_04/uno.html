<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ejercicio 1</title>
    <script src="../src/eventos.js"></script>
    <script src="../src/validaciones.js"></script>
    <script>
        window.addEventListener("load", iniciar);

        function iniciar() {
            document.getElementById("nom").addEventListener("change", aniadirMayus);
            document.getElementById("ape").addEventListener("change", aniadirMayus);
            document.getElementById("ciu").addEventListener("change", mostrarPob);
            document.getElementById("aniadir").addEventListener("click", aniadirTel);
        }

        function aniadirMayus() {
            let texto = event.target
            if (texto.id == "nom") {
                let nombre = document.getElementById("nom").value;
                let mayusNombre = capitalize(nombre);
                document.getElementById("nom").value = mayusNombre;
            } else {
                let apellidos = document.getElementById("ape").value.split(" ");
                for (let i = 0; i < apellidos.length; i++) {
                    apellidos[i] = capitalize(apellidos[i]);
                }
                document.getElementById("ape").value = apellidos;
            }
        }

        function mostrarPob() {
            //let poblaciones = ["Huércal de Almeria", "Vícar", "El Ejido"];
            //let poblaciones = ["Loja", "Montefrío", "Almuñécar"];
            //let poblaciones = ["Marbella", "Mijas", "Fuengirola"];
            //let select = createSelect(poblaciones, "pob");
            if (document.getElementById("pob") != null) {
                document.getElementById("city").removeChild(document.getElementById("pob"))
            }
            let valor = event.target.value;
            let label = createLabel("Poblacion");
            switch (valor) {
                case "1":
                    let poblaciones1 = ["Huércal de Almeria", "Vícar", "El Ejido"];
                    let select1 = createSelect(poblaciones1, "pob1");
                    select1.addEventListener("change", aniadirCod);
                    let div1 = createDiv([label, select1], "pob");
                    document.getElementById("city").appendChild(div1);
                    break;
                case "2":
                    let poblaciones2 = ["Loja", "Montefrío", "Almuñécar"];
                    let select2 = createSelect(poblaciones2, "pob2");
                    select2.addEventListener("change", aniadirCod);
                    let div2 = createDiv([label, select2], "pob");
                    document.getElementById("city").appendChild(div2);
                    break;
                case "3":
                    let poblaciones3 = ["Marbella", "Mijas", "Fuengirola"];
                    let select3 = createSelect(poblaciones3, "pob3");
                    select3.addEventListener("change", aniadirCod);
                    let div3 = createDiv([label, select3], "pob");
                    document.getElementById("city").appendChild(div3);
                    break;
            }
        }

        function aniadirCod() {
            let select = event.target;
            switch (select.id) {
                case "pob1":
                    rellenarInput(select, document.getElementById("cod"), ["04230", "04738", "04700"]);
                    break;
                case "pob2":
                    rellenarInput(select, document.getElementById("cod"), ["18300", "18270", "18690"]);
                    break;
                case "pob3":
                    rellenarInput(select, document.getElementById("cod"), ["29600", "29650", "29640"]);
                    break;
            }
        }

        function aniadirTel() {
            let telefono = document.getElementById("telefono").value;
            //regex vale para telefonos tipo (XXX XX XX XX)
            let regex = /[0-9]{3} [0-9]{2} [0-9]{2} [0-9]{2}/gm;
            let correcto = validateExpresion(telefono, regex);
            eliminarElemento("mensaje");
            if (!correcto) {
                mostrarError(document.getElementById("telefono"), "El Telefono no sigue la expresion regular dada. Asegurate de que el telefono sigue la siguiente estructura (XXX XX XX XX)");
            } else {
                mostrarCorrecto(document.getElementById("telefono"), "El telefono es correcto");
                let input = createInput("tel", "telefono2");
                //revisar esto
                document.getElementById("telefono").insertAdjacentElement("beforeend", input);
            }
            return false;
        }
    </script>
</head>

<body>
    <h1>Formulario con DOM y eventos Javascript</h1>
    <form name="as" id="formulario" method="post">
        <div>
            <label for="nom">Nombre</label>
            <input type="text" id="nom">
        </div>
        <div>
            <label for="ape">Apellidos</label>
            <input type="text" id="ape">
        </div>
        <div>
            <label for="dir">Direccion</label>
            <input type="text" id="dir">
        </div>
        <div id="city">
            <label for="ciu">Ciudad</label>
            <select name="Ciudad" id="ciu">
                <option value="1">Almería</option>
                <option value="2">Granada</option>
                <option value="3">Málaga</option>
            </select>
        </div>
        <!-- poblacion va aqui crear con js -->
        <div>
            <label for="cod">Codigo Postal</label>
            <input type="text" disabled id="cod">
        </div>
        <div>
            <label for="telefono">Telefonos</label>
            <input type="tel" id="telefono" placeholder="XXX XX XX XX">
            <input type="button" id="aniadir" value="Añadir otro telefono">
        </div>
        <!-- Aqui van otros 2 telefonos (crear con js) -->
        <div>
            <label for="mail">Correo Electronico</label>
            <input type="email" id="mail">
        </div>
        <div>
            <label for="fecha">Fecha de Nacimiento</label>
            <input type="date" name="fecha" id="fecha">
        </div>
        <div>
            <label for="lugar">Lugar de Nacimiento</label>
            <input type="text" name="lugar" id="lugar">
        </div>
        <div>
            <button type="submit">Validar</button>
            <button type="reset">Cancelar</button>
        </div>
    </form>
</body>

</html>