<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="../src/eventos.js"></script>
    <script src="../src/storage.js"></script>
    <script>
        //Creamos un evento al cargar la pagina
        window.addEventListener("load", iniciar);

        function iniciar() {
            //AÃ±adimos los eventos a los botones
            document.getElementById("crear").addEventListener("click", guardarAlmacen);
            document.getElementById("buscar").addEventListener("click", buscarAlmacen);
            document.getElementById("borrar").addEventListener("click", borrarAlmacen);
            mostrarAlmacen(document.getElementById("almacen"));
        }

        function guardarAlmacen() {
            //Guardamos el valor de los inputs
            let clave = document.getElementById("nom").value;
            let valor = document.getElementById("valor").value;
            let usar = document.getElementsByName("usar");
            for (let i = 0; i < usar.length; i++) {
                if (usar[i].checked && usar[i].id == "usa_local") {
                    if (window.localStorage) {
                    //Localstorage esta activado, haz las operaciones
                    localStorage.setItem(clave, valor);
                    alert("Se ha guardado la clave en LocalStorage");
                    } else {
                    //Localstorage no esta activado, manda un error
                    let p = crearParrafo(new Error("Localstorage no esta activado"));
                    document.body.appendChild(p);
                    }
                } else if (usar[i].checked && usar[i].id == "usa_session") {
                    if (window.sessionStorage) {
                    //sessionStorage esta activado, haz las operaciones
                    sessionStorage.setItem(clave, valor);
                    alert("Se ha guardado la clave en SessionStorage");
                    } else {
                    //SessionStorage no esta activado, manda un error
                    let p = crearParrafo(new Error("sessionStorage no esta activado"));
                    document.body.appendChild(p);
                    }
                }
            }
            mostrarAlmacen(document.getElementById("almacen"));
        }

        function buscarAlmacen() {
            //Guardamos el nombre de la cookie
            let clave = document.getElementById("nom").value;
            if (window.localStorage) {
                //Localstorage esta activado
                let valor = localStorage.getItem(clave);
                if (valor == null) {
                    alert("La clave " +"'" +  clave +"'"+ " no existe en el almacenamiento local");
                } else {
                    alert("La clave " +"'"+clave +"'" +" tiene de valor " + "'"+ valor +"'");
                }
            } else {
                //Localstorage no esta activado, manda un error
                let p = crearParrafo(new Error("Localstorage no esta activado"));
                document.body.appendChild(p);
            }
            
        }

        function borrarAlmacen() {
            //Guardamos el nombre dado
            let clave = document.getElementById("nom").value;
            if (window.localStorage) {
                //Localstorage esta activado
                let valor = localStorage.getItem(clave);
                if (valor == null) {
                    alert("La clave "+ "'" + clave + "'" + " no existe en el almacenamiento local");
                } else {
                    localStorage.removeItem(clave);
                    alert("La clave " +"'" + clave + "'" + " ha sido eliminada del almacenamiento local");
                }
            } else {
                //Localstorage no esta activado, manda un error
                let p = crearParrafo(new Error("Localstorage no esta activado"));
                document.body.appendChild(p);
            } 
            if (window.sessionStorage) {
                let valor = sessionStorage.getItem(clave);
                if (valor == null) {
                    alert("La clave "+ "'" + clave + "'" + " no existe en el almacenamiento de sesion");
                } else {
                    sessionStorage.removeItem(clave);
                    alert("La clave " +"'" + clave + "'" + " ha sido eliminada del almacenamiento de sesion");
                }
            }
            mostrarAlmacen(document.getElementById("almacen"));
        }
        
    </script>
    <title>Ejercicio 2</title>
</head>
<body>
    <label for="nom">Nombre:</label>
    <input type="text" id="nom">
    <br>
    <label for="valor">Valor:</label>
    <input type="text" id="valor">
    <br>
    <input type="radio" value="LocalStorage" name="usar" id="usa_local"/> Usar LocalStorage
    <input type="radio" value="SessionStorage" name="usar" id="usa_session"/> Usar SessionStorage
    <br>
    <button id="crear">Guardar en Localstorage</button>
    <button id="buscar">Buscar en Localstorage con ese valor</button>
    <button id="borrar">Borrar del Localstorage con ese valor</button>
    <div id="almacen">

    </div>
</body>
</html>